cols<-c("initial"="#56B4E9","2-month"="#0072B2")
p<-ggplot(df_out,aes(x=PC1,y=PC2,color=samples$timepoint,shape=samples$site))
p<-p+geom_point(size=3)+
theme(axis.title = element_text(size=14))+
theme(axis.text=element_text(size=12))+
theme(legend.title = element_text(size=14))+
theme(legend.text = element_text(size=12))+
scale_color_manual(values=cols)+
guides(fill = guide_legend(override.aes=list(shape=21)))+
labs(x=xlab, y=ylab, color="Timepoint",shape="Site")+
facet_grid(.~samples$coral.species)+
coord_fixed(ratio=1)
p
#cols<-c("Colpophyllia natans"="#56B4E9","Diploria labyrinthiformis"="#0072B2")
cols<-c("Initial"="#56B4E9","2-month"="#0072B2")
p<-ggplot(df_out,aes(x=PC1,y=PC2,color=samples$timepoint,shape=samples$site))
p<-p+geom_point(size=3)+
theme(axis.title = element_text(size=14))+
theme(axis.text=element_text(size=12))+
theme(legend.title = element_text(size=14))+
theme(legend.text = element_text(size=12))+
scale_color_manual(values=cols)+
guides(fill = guide_legend(override.aes=list(shape=21)))+
labs(x=xlab, y=ylab, color="Timepoint",shape="Site")+
facet_grid(.~samples$coral.species)+
coord_fixed(ratio=1)
p
pdf("PCA.pdf",bg ="white",width=8.5)
p<-ggplot(df_out,aes(x=PC1,y=PC2,color=samples$timepoint,shape=samples$site))
p<-p+geom_point(size=3)+
theme(axis.title = element_text(size=14))+
theme(axis.text=element_text(size=12))+
theme(legend.title = element_text(size=14))+
theme(legend.text = element_text(size=12))+
scale_color_manual(values=cols)+
guides(fill = guide_legend(override.aes=list(shape=21)))+
labs(x=xlab, y=ylab, color="Timepoint",shape="Site")+
facet_grid(.~samples$coral.species)+
coord_fixed(ratio=1)
p
dev.off()
pdf("PCA.pdf",bg ="white",width=11)
p<-ggplot(df_out,aes(x=PC1,y=PC2,color=samples$timepoint,shape=samples$site))
p<-p+geom_point(size=3)+
theme(axis.title = element_text(size=14))+
theme(axis.text=element_text(size=12))+
theme(legend.title = element_text(size=14))+
theme(legend.text = element_text(size=12))+
scale_color_manual(values=cols)+
guides(fill = guide_legend(override.aes=list(shape=21)))+
labs(x=xlab, y=ylab, color="Timepoint",shape="Site")+
facet_grid(.~samples$coral.species)+
coord_fixed(ratio=1)
p
dev.off()
p<-ggplot(df_out,aes(x=PC1,y=PC2,color=samples$timepoint,shape=samples$site))
p<-p+geom_point(size=3)+
theme(axis.title = element_text(size=14))+
theme(axis.text=element_text(size=12))+
theme(legend.title = element_text(size=14))+
theme(legend.text = element_text(size=12))+
theme(strip.text.x = element_text(size=12, face="italic"))+
scale_color_manual(values=cols)+
guides(fill = guide_legend(override.aes=list(shape=21)))+
labs(x=xlab, y=ylab, color="Timepoint",shape="Site")+
facet_grid(.~samples$coral.species)+
coord_fixed(ratio=1)
p
p<-ggplot(df_out,aes(x=PC1,y=PC2,color=samples$timepoint,shape=samples$site))
p<-p+geom_point(size=3)+
theme(axis.title = element_text(size=14))+
theme(axis.text=element_text(size=14))+
theme(legend.title = element_text(size=14))+
theme(legend.text = element_text(size=14))+
theme(strip.text.x = element_text(size=14, face="italic"))+
scale_color_manual(values=cols)+
guides(fill = guide_legend(override.aes=list(shape=21)))+
labs(x=xlab, y=ylab, color="Timepoint",shape="Site")+
facet_grid(.~samples$coral.species)+
coord_fixed(ratio=1)
p
samples$timepoint<-factor(samples$timepoint,levels=c("initial","2-month"))
p<-ggplot(df_out,aes(x=PC1,y=PC2,color=samples$timepoint,shape=samples$site))
p<-p+geom_point(size=3)+
theme(axis.title = element_text(size=14))+
theme(axis.text=element_text(size=14))+
theme(legend.title = element_text(size=14))+
theme(legend.text = element_text(size=14))+
theme(strip.text.x = element_text(size=14, face="italic"))+
scale_color_manual(values=cols)+
guides(fill = guide_legend(override.aes=list(shape=21)))+
labs(x=xlab, y=ylab, color="Timepoint",shape="Site")+
facet_grid(.~samples$coral.species)+
coord_fixed(ratio=1)
p
samples$timepoint<-factor(samples$timepoint,levels=c("Initial","2-month"))
p<-ggplot(df_out,aes(x=PC1,y=PC2,color=samples$timepoint,shape=samples$site))
p<-p+geom_point(size=3)+
theme(axis.title = element_text(size=14))+
theme(axis.text=element_text(size=14))+
theme(legend.title = element_text(size=14))+
theme(legend.text = element_text(size=14))+
theme(strip.text.x = element_text(size=14, face="italic"))+
scale_color_manual(values=cols)+
guides(fill = guide_legend(override.aes=list(shape=21)))+
labs(x=xlab, y=ylab, color="Timepoint",shape="Site")+
facet_grid(.~samples$coral.species)+
coord_fixed(ratio=1)
p
samples$timepoint<-factor(samples$timepoint,levels=c("Initial","2-month"))
p<-ggplot(df_out,aes(x=PC1,y=PC2,color=samples$timepoint,shape=samples$site))
p<-p+geom_point(size=3)+
theme(axis.title = element_text(size=14))+
theme(axis.text=element_text(size=14))+
theme(legend.title = element_text(size=14))+
theme(legend.text = element_text(size=14))+
theme(strip.text.x = element_text(size=14, face="italic"))+
scale_color_manual(values=cols)+
guides(fill = guide_legend(override.aes=list(shape=21)))+
labs(x=xlab, y=ylab, color="Timepoint",shape="Site")+
facet_grid(.~samples$coral.species)+
coord_fixed(ratio=1)
p
otu <- read.table("silva_nochloronomito_otu_table_qf.txt",sep="\t",header=TRUE, row.names=1)
taxon <- read.table("silva_nochloronomito_taxa_table_qf.txt",sep="\t",header=TRUE,row.names=1)
samples<-read.table("metadata_qf.txt",sep="\t",header=T,row.names=1)
OTU = otu_table(otu, taxa_are_rows=FALSE)
taxon<-as.matrix(taxon)
TAX = tax_table(taxon)
sampledata = sample_data(samples)
ps_qf <- phyloseq(otu_table(otu, taxa_are_rows=FALSE),
sample_data(samples),
tax_table(taxon))
ps_qf
d.czm <- cmultRepl(t(otu), method="CZM", label=0, z.warning=1)
# Perform the center-log-ratio (CLR) transformation
d.clr <- codaSeq.clr(d.czm)
# transpose matrix of CLR transformed data for ordination and dendrogram
E.clr <- t(d.clr)
# plot compositional PCA biplot (perform a singular value decomposition)
d.pcx <- prcomp(E.clr)
# calculate percent variance explained for the axis labels
pc1 <- round(d.pcx$sdev[1]^2/sum(d.pcx$sdev^2),2)
pc2 <- round(d.pcx$sdev[2]^2/sum(d.pcx$sdev^2),2)
xlab <- paste("PC1: ", pc1, sep="")
ylab <- paste("PC2: ", pc2, sep="")
#biplot(d.pcx, cex=c(0.6,0.4), var.axes=F,scale=1, xlab=xlab, ylab=ylab)
summary(d.pcx)
str(d.pcx)
screeplot(d.pcx)
# Make a pretty PCA plot with ggplot
df_out <- as.data.frame(d.pcx$x)
theme_set(theme_bw()+theme(panel.grid.major = element_blank(),panel.grid.minor = element_blank()))
#cols<-c("Colpophyllia natans"="#56B4E9","Diploria labyrinthiformis"="#0072B2")
cols<-c("Initial"="#56B4E9","2-month"="#0072B2")
samples$timepoint<-factor(samples$timepoint,levels=c("Initial","2-month"))
p<-ggplot(df_out,aes(x=PC1,y=PC2,color=samples$timepoint,shape=samples$site))
p<-p+geom_point(size=3)+
theme(axis.title = element_text(size=14))+
theme(axis.text=element_text(size=14))+
theme(legend.title = element_text(size=14))+
theme(legend.text = element_text(size=14))+
theme(strip.text.x = element_text(size=14, face="italic"))+
scale_color_manual(values=cols)+
guides(fill = guide_legend(override.aes=list(shape=21)))+
labs(x=xlab, y=ylab, color="Timepoint",shape="Site")+
facet_grid(.~samples$coral.species)+
coord_fixed(ratio=1)
p
pdf("PCA.pdf",bg ="white",width=11)
p<-ggplot(df_out,aes(x=PC1,y=PC2,color=samples$timepoint,shape=samples$site))
p<-p+geom_point(size=3)+
theme(axis.title = element_text(size=14))+
theme(axis.text=element_text(size=14))+
theme(legend.title = element_text(size=14))+
theme(legend.text = element_text(size=14))+
theme(strip.text.x = element_text(size=14, face="italic"))+
scale_color_manual(values=cols)+
guides(fill = guide_legend(override.aes=list(shape=21)))+
labs(x=xlab, y=ylab, color="Timepoint",shape="Site")+
facet_grid(.~samples$coral.species)+
coord_fixed(ratio=1)
p
dev.off()
p<-ggplot(df_out,aes(x=PC1,y=PC2,color=samples$timepoint,shape=samples$site))
p<-p+geom_point(size=3)+
theme(axis.title = element_text(size=14))+
theme(axis.text=element_text(size=14))+
theme(legend.title = element_text(size=14))+
theme(legend.text = element_text(size=14))+
theme(strip.text.x = element_text(size=14, face="italic"))+
scale_color_manual(values=cols)+
guides(fill = guide_legend(override.aes=list(shape=21)))+
labs(x=xlab, y=ylab, color="Timepoint",shape="Site")+
facet_grid(.~samples$coral.species)+
ylim(-75,75)+
xlim(-75,75)+
coord_fixed(ratio=1)
p
p<-ggplot(df_out,aes(x=PC1,y=PC2,color=samples$timepoint,shape=samples$site))
p<-p+geom_point(size=3)+
theme(axis.title = element_text(size=14))+
theme(axis.text=element_text(size=14))+
theme(legend.title = element_text(size=14))+
theme(legend.text = element_text(size=14))+
theme(strip.text.x = element_text(size=14, face="italic"))+
scale_color_manual(values=cols)+
guides(fill = guide_legend(override.aes=list(shape=21)))+
labs(x=xlab, y=ylab, color="Timepoint",shape="Site")+
facet_grid(.~samples$coral.species)+
ylim(-100,100)+
xlim(-100,100)+
coord_fixed(ratio=1)
p
p<-ggplot(df_out,aes(x=PC1,y=PC2,color=samples$timepoint,shape=samples$site))
p<-p+geom_point(size=3)+
theme(axis.title = element_text(size=14))+
theme(axis.text=element_text(size=14))+
theme(legend.title = element_text(size=14))+
theme(legend.text = element_text(size=14))+
theme(strip.text.x = element_text(size=14, face="italic"))+
scale_color_manual(values=cols)+
guides(fill = guide_legend(override.aes=list(shape=21)))+
labs(x=xlab, y=ylab, color="Timepoint",shape="Site")+
facet_grid(.~samples$coral.species)+
ylim(-80,80)+
xlim(-80,80)+
coord_fixed(ratio=1)
p
p<-ggplot(df_out,aes(x=PC1,y=PC2,color=samples$timepoint,shape=samples$site))
p<-p+geom_point(size=3)+
theme(axis.title = element_text(size=14))+
theme(axis.text=element_text(size=14))+
theme(legend.title = element_text(size=14))+
theme(legend.text = element_text(size=14))+
theme(strip.text.x = element_text(size=14, face="italic"))+
scale_color_manual(values=cols)+
guides(fill = guide_legend(override.aes=list(shape=21)))+
labs(x=xlab, y=ylab, color="Timepoint",shape="Site")+
facet_grid(.~samples$coral.species)+
ylim(-90,90)+
xlim(-90,90)+
coord_fixed(ratio=1)
p
p<-ggplot(df_out,aes(x=PC1,y=PC2,color=samples$timepoint,shape=samples$site))
p<-p+geom_point(size=3)+
theme(axis.title = element_text(size=14))+
theme(axis.text=element_text(size=14))+
theme(legend.title = element_text(size=14))+
theme(legend.text = element_text(size=14))+
theme(strip.text.x = element_text(size=14, face="italic"))+
scale_color_manual(values=cols)+
guides(fill = guide_legend(override.aes=list(shape=21)))+
labs(x=xlab, y=ylab, color="Timepoint",shape="Site")+
facet_grid(.~samples$coral.species)+
ylim(-50,50)+
xlim(-90,90)+
coord_fixed(ratio=1)
p
pdf("PCA.pdf",bg ="white",width=11)
p<-ggplot(df_out,aes(x=PC1,y=PC2,color=samples$timepoint,shape=samples$site))
p<-p+geom_point(size=3)+
theme(axis.title = element_text(size=14))+
theme(axis.text=element_text(size=14))+
theme(legend.title = element_text(size=14))+
theme(legend.text = element_text(size=14))+
theme(strip.text.x = element_text(size=14, face="italic"))+
scale_color_manual(values=cols)+
guides(fill = guide_legend(override.aes=list(shape=21)))+
labs(x=xlab, y=ylab, color="Timepoint",shape="Site")+
facet_grid(.~samples$coral.species)+
ylim(-50,50)+
xlim(-90,90)+
coord_fixed(ratio=1)
p
dev.off()
time<-as.character(samples$timepoint)
site<-as.character(samples$site)
species<-as.character(samples$coral.species)
dist.clr <- dist(E.clr)
perm<-adonis2(dist.clr~coral.species*timepoint,as(sample_data(ps_qf),"data.frame"))
print(perm)
perm2<-pairwise.adonis2(dist.clr~site/coral.species,as(sample_data(ps_qf),"data.frame"), strata='coral.species')
print(perm2)
colony<-as.character(samples$colony)
perm3<-pairwise.adonis2(dist.clr~site/colony,as(sample_data(ps_qf),"data.frame"), strata='colony')
print(perm3)
perm3<-pairwise.adonis2(dist.clr~timepoint/colony,as(sample_data(ps_qf),"data.frame"), strata='colony')
print(perm3)
perm1<-adonis2(dist.clr~colony*timepoint,as(sample_data(ps_qf),"data.frame"))
print(perm1)
otu <- read.table("silva_nochloronomito_otu_table_qf.txt",sep="\t",header=TRUE, row.names=1)
taxon <- read.table("silva_nochloronomito_taxa_table_qf.txt",sep="\t",header=TRUE,row.names=1)
samples<-read.table("metadata_qf.txt",sep="\t",header=T,row.names=1)
OTU = otu_table(otu, taxa_are_rows=FALSE)
taxon<-as.matrix(taxon)
TAX = tax_table(taxon)
sampledata = sample_data(samples)
ps_qf <- phyloseq(otu_table(otu, taxa_are_rows=FALSE),
sample_data(samples),
tax_table(taxon))
ps_qf
ps_2mon = subset_samples(ps_qf, timepoint == "2-month")
ps_2mon
d.czm <- cmultRepl(t(otu), method="CZM", label=0, z.warning=1)
# Perform the center-log-ratio (CLR) transformation
d.clr <- codaSeq.clr(d.czm)
# transpose matrix of CLR transformed data for ordination and dendrogram
E.clr <- t(d.clr)
# plot compositional PCA biplot (perform a singular value decomposition)
d.pcx <- prcomp(E.clr)
# calculate percent variance explained for the axis labels
pc1 <- round(d.pcx$sdev[1]^2/sum(d.pcx$sdev^2),2)
pc2 <- round(d.pcx$sdev[2]^2/sum(d.pcx$sdev^2),2)
xlab <- paste("PC1: ", pc1, sep="")
ylab <- paste("PC2: ", pc2, sep="")
summary(d.pcx)
str(d.pcx)
screeplot(d.pcx)
# Make a pretty PCA plot with ggplot
df_out <- as.data.frame(d.pcx$x)
theme_set(theme_bw()+theme(panel.grid.major = element_blank(),panel.grid.minor = element_blank()))
cols<-c("Colpophyllia natans"="#56B4E9","Diploria labyrinthiformis"="#0072B2")
p<-ggplot(df_out,aes(x=PC1,y=PC2,color=samples$coral.species,shape=samples$site))
p<-p+geom_point(size=3)+
theme(axis.title = element_text(size=14))+
theme(axis.text=element_text(size=14))+
theme(legend.title = element_text(size=14))+
theme(legend.text = element_text(size=14))+
theme(strip.text.x = element_text(size=14, face="italic"))+
scale_color_manual(values=cols)+
guides(fill = guide_legend(override.aes=list(shape=21)))+
labs(x=xlab, y=ylab, color="Coral species",shape="Site")+
facet_grid(.~samples$coral.species)+
#ylim(-50,50)+
#xlim(-90,90)+
coord_fixed(ratio=1)
p
otu <- read.table("silva_nochloronomito_otu_table_qf.txt",sep="\t",header=TRUE, row.names=1)
taxon <- read.table("silva_nochloronomito_taxa_table_qf.txt",sep="\t",header=TRUE,row.names=1)
samples<-read.table("metadata_qf.txt",sep="\t",header=T,row.names=1)
OTU = otu_table(otu, taxa_are_rows=FALSE)
taxon<-as.matrix(taxon)
TAX = tax_table(taxon)
sampledata = sample_data(samples)
ps_qf <- phyloseq(otu_table(otu, taxa_are_rows=FALSE),
sample_data(samples),
tax_table(taxon))
ps_qf #2032 taxa and 152 samples
ps_2mon = subset_samples(ps_qf, timepoint == "2-month")
ps_2mon
otu_2 = as(otu_table(ps_2mon), "matrix")
taxon_2 = as(tax_table(ps_2mon), "matrix")
metadata_2 = as(sample_data(ps_2mon), "matrix")
write.table(otu_2,"silva_nochloronomito_otu_table_2month.txt",sep="\t",col.names=NA)
write.table(taxon_2,"silva_nochloronomito_taxa_table_2month.txt",sep="\t",col.names=NA)
write.table(metadata_2,"metadata_2month.txt",sep="\t",col.names=NA)
otu <- read.table("silva_nochloronomito_otu_table_2month.txt",sep="\t",header=TRUE, row.names=1)
taxon <- read.table("silva_nochloronomito_taxa_table_2month.txt",sep="\t",header=TRUE,row.names=1)
samples<-read.table("metadata_2month.txt",sep="\t",header=T,row.names=1)
OTU = otu_table(otu, taxa_are_rows=FALSE)
taxon<-as.matrix(taxon)
TAX = tax_table(taxon)
sampledata = sample_data(samples)
ps <- phyloseq(otu_table(otu, taxa_are_rows=FALSE),
sample_data(samples),
tax_table(taxon))
ps
d.czm <- cmultRepl(t(otu), method="CZM", label=0, z.warning=1)
# Perform the center-log-ratio (CLR) transformation
d.clr <- codaSeq.clr(d.czm)
# transpose matrix of CLR transformed data for ordination and dendrogram
E.clr <- t(d.clr)
# plot compositional PCA biplot (perform a singular value decomposition)
d.pcx <- prcomp(E.clr)
# calculate percent variance explained for the axis labels
pc1 <- round(d.pcx$sdev[1]^2/sum(d.pcx$sdev^2),2)
pc2 <- round(d.pcx$sdev[2]^2/sum(d.pcx$sdev^2),2)
xlab <- paste("PC1: ", pc1, sep="")
ylab <- paste("PC2: ", pc2, sep="")
#biplot(d.pcx, cex=c(0.6,0.4), var.axes=F,scale=1, xlab=xlab, ylab=ylab)
summary(d.pcx)
str(d.pcx)
screeplot(d.pcx)
df_out <- as.data.frame(d.pcx$x)
theme_set(theme_bw()+theme(panel.grid.major = element_blank(),panel.grid.minor = element_blank()))
cols<-c("Colpophyllia natans"="#56B4E9","Diploria labyrinthiformis"="#0072B2")
p<-ggplot(df_out,aes(x=PC1,y=PC2,color=samples$coral.species,shape=samples$site))
p<-p+geom_point(size=3)+
theme(axis.title = element_text(size=14))+
theme(axis.text=element_text(size=14))+
theme(legend.title = element_text(size=14))+
theme(legend.text = element_text(size=14))+
theme(strip.text.x = element_text(size=14, face="italic"))+
scale_color_manual(values=cols)+
guides(fill = guide_legend(override.aes=list(shape=21)))+
labs(x=xlab, y=ylab, color="Coral species",shape="Site")+
facet_grid(.~samples$coral.species)+
#ylim(-50,50)+
#xlim(-90,90)+
coord_fixed(ratio=1)
p
site<-as.character(samples$site)
species<-as.character(samples$coral.species)
colony<-as.character(samples$colony)
# permanova between groups using Aitchison distance
dist.clr <- dist(E.clr)
perm<-pairwise.adonis2(dist.clr~site/coral.species,as(sample_data(ps_qf),"data.frame"), strata='coral.species')
perm<-pairwise.adonis2(dist.clr~site/coral.species,as(sample_data(ps),"data.frame"), strata='coral.species')
print(perm)
perm2<-pairwise.adonis2(dist.clr~site/colony,as(sample_data(ps),"data.frame"), strata='colony')
print(perm2)
perm3<-pairwise.adonis2(dist.clr~colony,as(sample_data(ps),"data.frame"))
perm3<-adonis2(dist.clr~colony,as(sample_data(ps),"data.frame"))
print(perm3)
p<-ggplot(df_out,aes(x=PC1,y=PC2,color=samples$coral.species,shape=samples$site))
p<-p+geom_point(size=3)+
theme(axis.title = element_text(size=14))+
theme(axis.text=element_text(size=14))+
theme(legend.title = element_text(size=14))+
theme(legend.text = element_text(size=14))+
theme(strip.text.x = element_text(size=14, face="italic"))+
scale_color_manual(values=cols)+
guides(fill = guide_legend(override.aes=list(shape=21)))+
labs(x=xlab, y=ylab, color="Coral species",shape="Site")+
facet_grid(.~samples$coral.species)+
#ylim(-50,50)+
#xlim(-90,90)+
coord_fixed(ratio=1)
p
p<-ggplot(df_out,aes(x=PC1,y=PC2,color=samples$coral.species,shape=samples$site))
p<-p+geom_point(size=3)+
theme(axis.title = element_text(size=14))+
theme(axis.text=element_text(size=14))+
theme(legend.title = element_text(size=14))+
theme(legend.text = element_text(size=14))+
theme(strip.text.x = element_text(size=14, face="italic"))+
scale_color_manual(values=cols)+
guides(fill = guide_legend(override.aes=list(shape=21)))+
labs(x=xlab, y=ylab, color="Coral species",shape="Site")+
facet_grid(.~samples$coral.species)+
ylim(-50,50)+
xlim(-50,50)+
coord_fixed(ratio=1)
p
pdf("PCA_2month.pdf",bg ="white",width=11)
p<-ggplot(df_out,aes(x=PC1,y=PC2,color=samples$coral.species,shape=samples$site))
p<-p+geom_point(size=3)+
theme(axis.title = element_text(size=14))+
theme(axis.text=element_text(size=14))+
theme(legend.title = element_text(size=14))+
theme(legend.text = element_text(size=14))+
theme(strip.text.x = element_text(size=14, face="italic"))+
scale_color_manual(values=cols)+
guides(fill = guide_legend(override.aes=list(shape=21)))+
labs(x=xlab, y=ylab, color="Coral species",shape="Site")+
facet_grid(.~samples$coral.species)+
ylim(-50,50)+
xlim(-50,50)+
coord_fixed(ratio=1)
p
dev.off()
otu <- read.table("silva_nochloronomito_otu_table_qf.txt",sep="\t",header=TRUE, row.names=1)
taxon <- read.table("silva_nochloronomito_taxa_table_qf.txt",sep="\t",header=TRUE,row.names=1)
samples<-read.table("metadata_qf.txt",sep="\t",header=T,row.names=1)
OTU = otu_table(otu, taxa_are_rows=FALSE)
taxon<-as.matrix(taxon)
TAX = tax_table(taxon)
sampledata = sample_data(samples)
ps_qf <- phyloseq(otu_table(otu, taxa_are_rows=FALSE),
sample_data(samples),
tax_table(taxon))
ps_qf
d.czm <- cmultRepl(t(otu), method="CZM", label=0, z.warning=1)
# Perform the center-log-ratio (CLR) transformation
d.clr <- codaSeq.clr(d.czm)
# transpose matrix of CLR transformed data for ordination and dendrogram
E.clr <- t(d.clr)
# plot compositional PCA biplot (perform a singular value decomposition)
d.pcx <- prcomp(E.clr)
# calculate percent variance explained for the axis labels
pc1 <- round(d.pcx$sdev[1]^2/sum(d.pcx$sdev^2),2)
pc2 <- round(d.pcx$sdev[2]^2/sum(d.pcx$sdev^2),2)
xlab <- paste("PC1: ", pc1, sep="")
ylab <- paste("PC2: ", pc2, sep="")
#biplot(d.pcx, cex=c(0.6,0.4), var.axes=F,scale=1, xlab=xlab, ylab=ylab)
summary(d.pcx)
str(d.pcx)
screeplot(d.pcx)
# Make a pretty PCA plot with ggplot
df_out <- as.data.frame(d.pcx$x)
theme_set(theme_bw()+theme(panel.grid.major = element_blank(),panel.grid.minor = element_blank()))
#cols<-c("Colpophyllia natans"="#56B4E9","Diploria labyrinthiformis"="#0072B2")
cols<-c("Initial"="#56B4E9","2-month"="#0072B2")
samples$timepoint<-factor(samples$timepoint,levels=c("Initial","2-month"))
time<-as.character(samples$timepoint)
site<-as.character(samples$site)
species<-as.character(samples$coral.species)
colony<-as.character(samples$colony)
View(samples)
# permanova between groups using Aitchison distance
dist.clr <- dist(E.clr)
perm<-adonis2(dist.clr~coral.species*timepoint,as(sample_data(ps_qf),"data.frame"))
print(perm)
perm1<-adonis2(dist.clr~colony*timepoint,as(sample_data(ps_qf),"data.frame"))
print(perm1)
perm<-adonis2(dist.clr~coral.species*time,as(sample_data(ps_qf),"data.frame"))
print(perm)
perm2<-pairwise.adonis2(dist.clr~site/coral.species,as(sample_data(ps_qf),"data.frame"), strata='coral.species')
print(perm2)
perm3<-pairwise.adonis2(dist.clr~timepoint/colony,as(sample_data(ps_qf),"data.frame"), strata='colony')
print(perm3)
